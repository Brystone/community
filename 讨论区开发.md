登录：

service 

处理账号、密码空值，验证账号是否存在、是否激活、密码是否正确；登录成功后生成用户凭证，记录用户登录的状态用户凭证设置凭证的过期时间，是一个常量。

controller

首先验证激活码，然后验证用户名、密码； 查看map中是否有凭证，有说明登录成功；

服务器将凭证放到cookie中，通过response发送给浏览器并保存；

```java
Cookie cookie = new Cookie("ticket", (String)map.get("ticket"));
response.addCookie(cookie);
```

登录成功后重定向到首页

```java
return "redirect:/index";
```

让凭证在所有页面有效

```java
cookie.setPath(contextPath);
```

退出功能： 更新用户凭证的状态， controller使用CookieValue 注解获取客户端的凭证，然后更新，退出后返回登录界面。

**需求**：，登录后在每个页面显示用户的头像，点击头像示登录信息  隐藏注册和登录链接；

 使用拦截器来实现 

在请求开始时查询登录用户

![1590580435313](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1590580435313.png)

```
定义拦截器类并实现spring拦截器接口
重写preHander方法，在请求开始的时候拦截， 从cookie中获取凭证，然后通过凭证查询到用户并暂存用户。考虑到服务器在处理请求是多线程的方式（每一个请求开启一个线程来处理）， 如果将user放到普通的容器中，可能会出现当前获取到用户信息被篡改等并发问题，将user放到ThreadLocal中。
重写 psotHandle方法，在模板调用前使用，将用户信息放到视图中去；
请求结束后在local清除用户
```

**需求：**用户自己更换头像 

